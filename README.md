# Bengaluru Air Quality Monitor

A comprehensive real-time air quality monitoring system for Bengaluru with advanced ML predictions, analytics, and environmental alerts. Built with Next.js 15, Supabase, and OpenWeather API integration.

## 🌟 Features

- **Real-time Air Quality Monitoring**: Live data from 25+ locations across Bengaluru
- **ML-Powered Predictions**: Advanced ensemble models for air quality forecasting up to 48 hours
- **Comprehensive Analytics**: City-wide insights, area comparisons, and trend analysis
- **Environmental Alerts**: Automated threshold-based alert system for health warnings
- **Admin Dashboard**: Data management and ML prediction controls
- **Responsive Design**: Modern UI with dark/light theme support
- **RESTful API**: Complete API suite for data access and integrations

## 🏗️ Tech Stack

- **Frontend**: Next.js 15 (App Router), React 18, TypeScript
- **Styling**: Tailwind CSS v4, shadcn/ui components
- **Database**: Supabase (PostgreSQL)
- **External APIs**: OpenWeather API for air quality and weather data
- **ML Engine**: Custom ensemble models with confidence scoring
- **Deployment**: Vercel (recommended)

## 📋 Prerequisites

Before setting up the project, ensure you have:

- **Node.js** 18.17 or later
- **npm** or **yarn** package manager
- **Supabase** account and project
- **OpenWeather API** key (free tier available)
- **Vercel** account (for deployment)

## 🚀 Quick Start

### 1. Clone the Repository

\`\`\`bash
git clone <your-repository-url>
cd bengaluru-air-quality-monitor
\`\`\`

### 2. Install Dependencies

\`\`\`bash
npm install
# or
yarn install
\`\`\`

### 3. Environment Variables Setup

Create a `.env.local` file in the root directory with the following variables:

\`\`\`env
# Supabase Configuration
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Database Configuration (Auto-generated by Supabase)
POSTGRES_URL=your_postgres_connection_string
POSTGRES_PRISMA_URL=your_postgres_prisma_url
POSTGRES_URL_NON_POOLING=your_postgres_non_pooling_url
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DATABASE=your_postgres_database
POSTGRES_HOST=your_postgres_host

# OpenWeather API
OPENWEATHER_API_KEY=your_openweather_api_key
\`\`\`

### 4. Database Setup

#### Option A: Using the v0 Interface (Recommended)
1. Open the project in v0
2. Navigate to the Scripts section
3. Run the SQL scripts in order:
   - `001_create_air_quality_tables.sql`
   - `002_seed_bengaluru_areas.sql`

#### Option B: Manual Setup
1. Access your Supabase dashboard
2. Go to SQL Editor
3. Execute the scripts from the `scripts/` folder in order

### 5. Verify Database Setup

Check that the following tables were created:
- `areas` (25 Bengaluru locations)
- `air_quality_readings` (historical data)
- `air_quality_predictions` (ML forecasts)
- `air_quality_alerts` (environmental alerts)

### 6. Start Development Server

\`\`\`bash
npm run dev
# or
yarn dev
\`\`\`

Visit `http://localhost:3000` to see the application.

## 📊 Initial Data Collection

### 1. Fetch Air Quality Data

Navigate to `/admin` and use the Data Fetcher to:
- Fetch current air quality data from OpenWeather API
- Populate the database with initial readings
- Verify API connectivity

### 2. Generate ML Predictions

In the admin dashboard:
- Select areas for prediction generation
- Choose prediction horizon (24-48 hours)
- Generate initial ML forecasts

## 🔧 Configuration

### OpenWeather API Setup

1. Sign up at [OpenWeather](https://openweathermap.org/api)
2. Subscribe to the Air Pollution API (free tier: 1000 calls/day)
3. Add your API key to environment variables
4. Test the connection using the admin dashboard

### Supabase Configuration

1. Create a new Supabase project
2. Enable Row Level Security (RLS) policies are pre-configured
3. Set up environment variables
4. Run the database migration scripts

## 📡 API Documentation

### Air Quality Data APIs

#### GET `/api/air-quality/areas`
Fetch all areas with latest readings
\`\`\`json
{
  "areas": [...],
  "count": 25
}
\`\`\`

#### GET `/api/air-quality/[areaId]`
Get specific area data with history
- Query params: `limit` (default: 24), `hours` (default: 24)

#### POST `/api/air-quality/fetch`
Fetch fresh data from OpenWeather API for all areas

### Analytics APIs

#### GET `/api/analytics/citywide`
City-wide analytics (7-day analysis)

#### GET `/api/analytics/area/[areaId]`
Area-specific analytics and insights

#### GET `/api/analytics/comparison`
Compare all areas (24-hour analysis)

### ML Prediction APIs

#### POST `/api/predictions/generate`
Generate predictions for specific area
\`\`\`json
{
  "areaId": "uuid",
  "hoursAhead": 24
}
\`\`\`

#### POST `/api/predictions/batch`
Generate predictions for all areas
\`\`\`json
{
  "hoursAhead": 24
}
\`\`\`

### Alert System APIs

#### GET `/api/alerts`
Get active alerts (optional `areaId` filter)

#### POST `/api/alerts/check`
Manually trigger alert checking

#### DELETE `/api/alerts?alertId=uuid`
Dismiss specific alert

## 🎯 Usage Guide

### Main Dashboard (`/`)
- View real-time air quality across all areas
- Interactive map with AQI indicators
- Recent readings and trends
- Environmental alerts

### Analytics Dashboard (`/analytics`)
- Comprehensive city-wide insights
- Area comparisons and rankings
- Historical trends and patterns
- Data visualization charts

### Admin Dashboard (`/admin`)
- Data collection management
- ML prediction controls
- System status monitoring
- API configuration

## 🔍 Monitoring Areas

The system monitors 25 key locations across Bengaluru:

**Central**: MG Road, Brigade Road, Commercial Street, Cubbon Park
**North**: Hebbal, Yelahanka, Devanahalli, Bagalur
**South**: Koramangala, BTM Layout, Jayanagar, Banashankari, JP Nagar
**East**: Whitefield, Marathahalli, Indiranagar, Domlur
**West**: Rajajinagar, Malleshwaram, Vijayanagar, Peenya
**Outer**: Electronic City, Sarjapur, Kengeri, Tumkur Road

## 🤖 Machine Learning Features

### Prediction Models
- **Ensemble Approach**: Combines multiple algorithms for accuracy
- **Feature Engineering**: Weather patterns, temporal trends, spatial correlations
- **Confidence Scoring**: Reliability metrics for each prediction
- **Horizon**: 1-48 hours ahead forecasting

### Model Performance
- **Accuracy**: Continuously improving with more data
- **Update Frequency**: Real-time learning from new readings
- **Validation**: Cross-validation across different areas and seasons

## 🚨 Alert System

### Alert Types
- **High AQI**: When AQI exceeds healthy levels (>100)
- **PM2.5 Warnings**: Dangerous particulate matter levels
- **Health Advisories**: Recommendations for sensitive groups

### Severity Levels
- **Moderate**: Sensitive individuals should limit outdoor activities
- **Unhealthy**: Everyone should reduce outdoor activities
- **Hazardous**: Emergency conditions, avoid outdoor activities

## 🛠️ Development

### Project Structure
\`\`\`
├── app/                    # Next.js app directory
│   ├── api/               # API routes
│   ├── admin/             # Admin dashboard
│   ├── analytics/         # Analytics dashboard
│   └── globals.css        # Global styles
├── components/            # React components
├── lib/                   # Utility libraries
│   ├── analytics/         # Analytics engine
│   ├── ml/               # ML prediction models
│   ├── supabase/         # Database client
│   └── types/            # TypeScript definitions
└── scripts/              # Database migration scripts
\`\`\`

### Adding New Areas
1. Insert new area in `areas` table with coordinates
2. Update the seeding script for future deployments
3. Test data collection for the new location

### Extending ML Models
1. Modify `lib/ml/air-quality-predictor.ts`
2. Add new features to the feature engineering pipeline
3. Update model version and retrain with historical data

## 🚀 Deployment

### Vercel Deployment (Recommended)
1. Connect your GitHub repository to Vercel
2. Add environment variables in Vercel dashboard
3. Deploy automatically on push to main branch

### Manual Deployment
\`\`\`bash
npm run build
npm start
\`\`\`

## 🔧 Troubleshooting

### Common Issues

**Database Connection Errors**
- Verify Supabase environment variables
- Check RLS policies are properly configured
- Ensure database tables exist

**OpenWeather API Issues**
- Verify API key is valid and active
- Check API quota limits (1000 calls/day on free tier)
- Ensure Air Pollution API is enabled

**Missing Data**
- Run data fetcher from admin dashboard
- Check API response logs in browser console
- Verify area coordinates are correct

**ML Prediction Errors**
- Ensure sufficient historical data (minimum 24 hours)
- Check prediction horizon limits (max 48 hours)
- Verify model version compatibility

### Performance Optimization
- Enable database connection pooling
- Implement caching for frequently accessed data
- Use batch operations for bulk data processing
- Monitor API rate limits and implement queuing

## 📈 Monitoring & Maintenance

### Regular Tasks
- **Daily**: Monitor data collection and API quotas
- **Weekly**: Review ML model performance and accuracy
- **Monthly**: Analyze system usage and optimize performance

### Health Checks
- Database connectivity and performance
- API response times and error rates
- ML prediction accuracy and confidence scores
- Alert system functionality

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📄 License

This project is licensed under the MIT License - see the LICENSE file for details.

## 🙏 Acknowledgments

- **OpenWeather API** for air quality and weather data
- **Supabase** for database and backend services
- **Vercel** for hosting and deployment platform
- **shadcn/ui** for beautiful UI components

## 📞 Support

For issues and questions:
1. Check the troubleshooting section above
2. Review API documentation
3. Open an issue on GitHub
4. Contact the development team

---

**Built with ❤️ for cleaner air in Bengaluru**
